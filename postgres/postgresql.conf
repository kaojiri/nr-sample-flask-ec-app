# PostgreSQL設定ファイル
# New Relic監視のための最小限設定

# 共有ライブラリの設定（pg_stat_statementsを有効にする）
shared_preload_libraries = 'pg_stat_statements'

# pg_stat_statements設定（Query Performance Monitoring用）
pg_stat_statements.max = 10000
pg_stat_statements.track = all
pg_stat_statements.track_utility = on
pg_stat_statements.track_planning = on  # プランニング時間も追跡
pg_stat_statements.save = on

# 統計情報収集の設定（New Relic監視に必要）
track_activities = on
track_counts = on
track_io_timing = on
track_functions = all

# ログ設定（Query Performance Monitoring用）
log_min_duration_statement = 1000  # 1秒以上のクエリをログに記録
log_duration = on
log_statement = 'all'

# Wait event monitoring（Wait Time Analysis用）
log_lock_waits = on
log_checkpoints = on
log_connections = on
log_disconnections = on

# Query Performance Monitoring用の詳細ログ設定
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_min_error_statement = error
log_min_messages = warning

# その他の設定はPostgreSQLのデフォルトを使用