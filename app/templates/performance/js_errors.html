{% extends "base.html" %}

{% block title %}JavaScript Errors Demo - EC Shop{% endblock %}

{% block content %}
<div class="alert alert-danger" role="alert">
    <h4 class="alert-heading">ğŸš¨ JavaScriptã‚¨ãƒ©ãƒ¼ãƒ‡ãƒ¢ãƒšãƒ¼ã‚¸</h4>
    <p>ã“ã®ãƒšãƒ¼ã‚¸ã«ã¯<strong>æ„å›³çš„ã«JavaScriptã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹ãƒœã‚¿ãƒ³</strong>ãŒã‚ã‚Šã¾ã™ã€‚</p>
    <hr>
    <p class="mb-0">New Relic Browserã§ã‚¨ãƒ©ãƒ¼ã‚’æ¤œçŸ¥ã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¢ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ï¼</p>
</div>

<h1>JavaScript ã‚¨ãƒ©ãƒ¼ãƒ‡ãƒ¢</h1>
<p class="lead">å„ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ç•°ãªã‚‹ç¨®é¡ã®JavaScriptã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€New Relic Browserã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚</p>

<div class="row mt-4">
    <div class="col-md-6 mb-4">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5>ğŸ’¥ Null Reference Error</h5>
            </div>
            <div class="card-body">
                <p><strong>ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—:</strong> TypeError</p>
                <p><strong>èª¬æ˜:</strong> nullã‚„undefinedã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹</p>
                <p><strong>New Relicã§æ¤œçŸ¥:</strong></p>
                <ul>
                    <li>JS Errors ãƒšãƒ¼ã‚¸ã«ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤º</li>
                    <li>ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒè¨˜éŒ²</li>
                    <li>ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®ãƒšãƒ¼ã‚¸URLã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±</li>
                </ul>
                <button onclick="triggerNullError()" class="btn btn-danger">ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹</button>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h5>âš ï¸ Undefined Function Error</h5>
            </div>
            <div class="card-body">
                <p><strong>ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—:</strong> ReferenceError</p>
                <p><strong>èª¬æ˜:</strong> å­˜åœ¨ã—ãªã„é–¢æ•°ã‚’å‘¼ã³å‡ºãã†ã¨ã™ã‚‹</p>
                <p><strong>New Relicã§æ¤œçŸ¥:</strong></p>
                <ul>
                    <li>é–¢æ•°åã¨å‘¼ã³å‡ºã—å…ƒã‚’è¨˜éŒ²</li>
                    <li>ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿå›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ</li>
                    <li>å½±éŸ¿ã‚’å—ã‘ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’è¡¨ç¤º</li>
                </ul>
                <button onclick="triggerUndefinedFunctionError()" class="btn btn-warning">ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹</button>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h5>ğŸ”„ Promise Rejection Error</h5>
            </div>
            <div class="card-body">
                <p><strong>ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—:</strong> UnhandledPromiseRejection</p>
                <p><strong>èª¬æ˜:</strong> PromiseãŒrejectã•ã‚ŒãŸãŒcatchã•ã‚Œãªã„</p>
                <p><strong>New Relicã§æ¤œçŸ¥:</strong></p>
                <ul>
                    <li>Promiseæ‹’å¦ã®ç†ç”±ã‚’è¨˜éŒ²</li>
                    <li>éåŒæœŸã‚¨ãƒ©ãƒ¼ã¨ã—ã¦åˆ†é¡</li>
                    <li>ã‚«ã‚¹ã‚¿ãƒ å±æ€§ä»˜ãã§è¨˜éŒ²</li>
                </ul>
                <button onclick="triggerPromiseRejection()" class="btn btn-info">ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹</button>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white">
                <h5>â±ï¸ Async Function Error</h5>
            </div>
            <div class="card-body">
                <p><strong>ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—:</strong> Error in async/await</p>
                <p><strong>èª¬æ˜:</strong> asyncé–¢æ•°å†…ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ</p>
                <p><strong>New Relicã§æ¤œçŸ¥:</strong></p>
                <ul>
                    <li>éåŒæœŸã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹</li>
                    <li>awaitæ™‚ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ</li>
                    <li>ã‚¿ã‚¤ãƒŸãƒ³ã‚°æƒ…å ±ã‚’è¨˜éŒ²</li>
                </ul>
                <button onclick="triggerAsyncError()" class="btn btn-primary">ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹</button>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card border-secondary">
            <div class="card-header bg-secondary text-white">
                <h5>ğŸŒ Network Error</h5>
            </div>
            <div class="card-body">
                <p><strong>ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—:</strong> Fetch API Error</p>
                <p><strong>èª¬æ˜:</strong> APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹</p>
                <p><strong>New Relicã§æ¤œçŸ¥:</strong></p>
                <ul>
                    <li>HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰</li>
                    <li>ãƒªã‚¯ã‚¨ã‚¹ãƒˆURL</li>
                    <li>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ </li>
                </ul>
                <button onclick="triggerNetworkError()" class="btn btn-secondary">ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹</button>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="card border-dark">
            <div class="card-header bg-dark text-white">
                <h5>ğŸ¯ Custom Error with Attributes</h5>
            </div>
            <div class="card-body">
                <p><strong>ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—:</strong> Custom Error</p>
                <p><strong>èª¬æ˜:</strong> ã‚«ã‚¹ã‚¿ãƒ å±æ€§ä»˜ãã®ã‚¨ãƒ©ãƒ¼</p>
                <p><strong>New Relicã§æ¤œçŸ¥:</strong></p>
                <ul>
                    <li>ã‚«ã‚¹ã‚¿ãƒ å±æ€§ã‚’å«ã‚€</li>
                    <li>ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±</li>
                    <li>ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®æƒ…å ±</li>
                </ul>
                <button onclick="triggerCustomError()" class="btn btn-dark">ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹</button>
            </div>
        </div>
    </div>
</div>

<div class="alert alert-success mt-4">
    <h5>âœ… New Relicã§ã®ç¢ºèªæ–¹æ³•</h5>
    <ol>
        <li><strong>Browser â†’ JS Errors</strong>: å…¨ã¦ã®JavaScriptã‚¨ãƒ©ãƒ¼ã‚’ä¸€è¦§è¡¨ç¤º</li>
        <li><strong>Errors Inbox</strong>: ã‚¨ãƒ©ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã—ã¦è¡¨ç¤º</li>
        <li><strong>Session Traces</strong>: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿå‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‚’ç¢ºèª</li>
        <li><strong>Error Analytics</strong>: ã‚¨ãƒ©ãƒ¼ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã¨åˆ†æ</li>
    </ol>
    <p class="mb-0"><strong>æ³¨æ„:</strong> New Relic Browserã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
</div>

<div class="mt-4">
    <a href="{{ url_for('performance.index') }}" class="btn btn-outline-primary me-2">â† ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¢ã«æˆ»ã‚‹</a>
    <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">â† Topãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
</div>

<script>
// 1. Null Reference Error
function triggerNullError() {
    console.log('Triggering null reference error...');
    var obj = null;
    // This will throw: TypeError: Cannot read property 'property' of null
    console.log(obj.property);
}

// 2. Undefined Function Error
function triggerUndefinedFunctionError() {
    console.log('Triggering undefined function error...');
    // This will throw: ReferenceError: thisDoesNotExist is not defined
    thisDoesNotExist();
}

// 3. Promise Rejection Error
function triggerPromiseRejection() {
    console.log('Triggering promise rejection...');
    // Promise that rejects without catch handler
    Promise.reject(new Error('Unhandled promise rejection for New Relic testing'))
        .then(function() {
            console.log('This will not execute');
        });
    // Note: No .catch() handler, so it becomes unhandled
}

// 4. Async Function Error
async function triggerAsyncError() {
    console.log('Triggering async error...');
    // Simulate async operation that fails
    await new Promise(resolve => setTimeout(resolve, 100));
    throw new Error('Error in async function for New Relic testing');
}

// 5. Network Error
async function triggerNetworkError() {
    console.log('Triggering network error...');
    try {
        const response = await fetch('{{ url_for("performance.api_fail") }}');
        if (!response.ok) {
            throw new Error('API request failed with status ' + response.status);
        }
    } catch (error) {
        console.error('Network error caught:', error);
        // Re-throw to ensure New Relic captures it
        if (window.newrelic) {
            window.newrelic.noticeError(error, {
                errorType: 'NetworkError',
                endpoint: '{{ url_for("performance.api_fail") }}',
                statusCode: 500
            });
        }
        throw error;
    }
}

// 6. Custom Error with Attributes
function triggerCustomError() {
    console.log('Triggering custom error with attributes...');
    var error = new Error('Custom error for New Relic demo');

    // Add custom attributes
    if (window.newrelic) {
        window.newrelic.noticeError(error, {
            errorType: 'CustomDemoError',
            component: 'JavaScriptErrorsDemo',
            severity: 'high',
            userId: '{{ current_user.id if current_user.is_authenticated else "anonymous" }}',
            timestamp: new Date().toISOString(),
            userAction: 'button_click',
            pageContext: 'js_errors_demo'
        });
    }

    throw error;
}

// Log page load
if (window.logToNewRelic) {
    window.logToNewRelic('info', 'JavaScript Errors Demo page loaded', {
        demoType: 'js_errors',
        availableErrors: 6
    });
}
</script>
{% endblock %}
