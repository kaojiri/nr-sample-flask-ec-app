# 実装計画

- [x] 1. 負荷テストコンテナの基本構造を作成
  - load-testerディレクトリとDockerfile作成
  - FastAPIアプリケーションの基本セットアップ
  - 基本的な設定管理システム実装
  - _Requirements: 1.1, 3.1_

- [x] 2. 基本設定管理とWeb UI基盤を実装
  - [x] 2.1 設定ファイルシステムの実装
    - JSON設定ファイルの読み書き機能
    - デフォルト設定値の管理
    - 設定値検証機能の実装
    - _Requirements: 3.1, 3.2, 3.3_

  - [x] 2.2 基本Web管理UIの作成
    - ダッシュボード画面の実装
    - 設定表示とステータス確認機能
    - Bootstrap UIフレームワーク統合
    - _Requirements: 3.1, 4.1_

  - [x] 2.3 基本API エンドポイントの実装
    - 設定取得・更新API
    - ステータス確認API
    - _Requirements: 6.2_

- [x] 3. Docker統合とデプロイメント設定
  - [x] 3.1 Dockerfileとコンテナ設定
    - 負荷テスト用Dockerfileの作成
    - 必要な依存関係のインストール
    - ヘルスチェック機能の実装
    - _Requirements: 1.1_

  - [x] 3.2 docker-compose統合
    - 既存docker-compose.ymlへの負荷テストサービス追加
    - ネットワーク設定とポート公開
    - ボリューム設定とデータ永続化
    - _Requirements: 1.1_

- [x] 4. エンドポイント選択とHTTPクライアント機能を実装
  - [x] 4.1 エンドポイント選択ロジックの実装
    - 重み付きランダム選択アルゴリズム実装
    - パフォーマンス問題エンドポイントの定義（/performance/slow, /performance/n-plus-one, /performance/slow-query, /performance/js-errors, /performance/bad-vitals）
    - エンドポイント統計の追跡機能
    - _Requirements: 2.1, 2.2_

  - [x] 4.2 非同期HTTPクライアントの実装
    - aiohttpを使用したHTTPリクエスト送信機能
    - タイムアウト処理とエラーハンドリング
    - リクエスト/レスポンスのログ記録
    - _Requirements: 1.1, 1.2, 2.4_

- [x] 5. 負荷テスト実行エンジンを実装
  - [x] 5.1 ワーカープールの実装
    - 設定可能な同時接続数での並行処理
    - リクエスト間隔のランダム制御
    - ワーカーの動的管理とライフサイクル制御
    - _Requirements: 1.1, 1.3, 2.3_

  - [x] 5.2 負荷テスト管理機能の実装
    - テストセッションの開始・停止制御
    - 実行状態の管理と監視
    - セッション情報の永続化
    - _Requirements: 1.1, 1.4, 4.1_

  - [x] 5.3 統計収集とリアルタイム監視
    - リクエスト数、成功率、エラー率の追跡
    - リアルタイム統計の更新機能
    - パフォーマンスメトリクスの計算
    - _Requirements: 4.1, 4.2_

- [x] 6. 拡張Web UI機能を実装
  - [x] 6.1 負荷テスト制御画面の作成
    - 開始・停止ボタンの実装
    - リアルタイム実行状態の表示
    - 緊急停止機能
    - _Requirements: 1.3, 4.1, 5.3_

  - [x] 6.2 設定管理フォームの実装
    - 負荷テストパラメータの設定フォーム
    - エンドポイント重み付け設定UI
    - 設定値のリアルタイム検証
    - _Requirements: 3.1, 3.2, 3.3_

  - [x] 6.3 統計表示ダッシュボードの実装
    - 送信済みリクエスト数の表示
    - 実行時間とエラー数の表示
    - エンドポイント別統計の表示
    - _Requirements: 4.1, 4.2_

- [x] 7. エラーハンドリングとセーフティ機能を実装
  - [x] 7.1 包括的エラーハンドリング
    - ネットワークエラーの処理
    - HTTPエラーレスポンスの処理
    - アプリケーションエラーの処理
    - _Requirements: 2.4, 5.1_

  - [x] 7.2 リソース保護機能の実装
    - 最大同時接続数の制限
    - CPU・メモリ使用量の監視
    - 自動負荷調整機能
    - _Requirements: 5.1, 5.2_

- [x] 8. 拡張API制御機能を実装
  - [x] 8.1 負荷テスト制御APIの実装
    - 開始・停止・状態確認API
    - セッション管理API
    - 統計取得API
    - _Requirements: 6.2_

  - [x] 8.2 スケジュール実行機能の実装
    - 指定時間での自動開始
    - 定期実行設定
    - スケジュール管理API
    - _Requirements: 6.1, 6.3_

- [x] 9. 統合テストと動作確認
  - [x] 9.1 基本機能の動作確認
    - 負荷テストの開始・停止テスト
    - 各エンドポイントへのアクセステスト
    - エラーハンドリングの確認
    - _Requirements: 1.1, 1.2, 2.1_

  - [x] 9.2 New Relic連携の確認
    - 負荷テスト実行中のNew Relicデータ確認
    - パフォーマンス問題の検出確認
    - 監視データの継続性確認
    - _Requirements: 2.1, 2.2_

- [x] 10. 追加パフォーマンステストエンドポイントの実装
  - [x] 10.1 新しいエンドポイント設定の追加
    - エンドポイント選択ロジックに新しいエンドポイント（/performance/error、/performance/slow-query/full-scan、/performance/slow-query/complex-join）を追加
    - デフォルト設定での重み付けと有効化設定
    - 設定ファイルの更新とバリデーション
    - _Requirements: 6.1, 6.2, 6.3_

  - [x] 10.2 エンドポイント統計とログ記録の拡張
    - 新しいエンドポイントの統計追跡機能
    - エラーハンドリングとログ記録の確認
    - 管理UIでの新しいエンドポイント表示
    - _Requirements: 6.4, 4.1, 4.2_

  - [x] 10.3 新しいエンドポイントの動作確認
    - 各新しいエンドポイントへのアクセステスト
    - エラー処理とログ記録の確認
    - 負荷テスト中の統計情報更新確認
    - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [x] 11. 複数ユーザーログイン機能を実装
  - [x] 11.1 ユーザーセッション管理システムの実装
    - TestUserとUserSessionのデータモデル作成
    - UserSessionManagerクラスの実装
    - ログインAPIを使用したセッション取得機能
    - _Requirements: 8.1, 8.2, 8.3_

  - [x] 11.2 ユーザー設定管理機能の実装
    - 設定ファイルでのテストユーザーアカウント管理
    - 管理UIでのユーザー設定表示・編集機能
    - ユーザー設定の検証とエラーハンドリング
    - _Requirements: 8.1_

  - [x] 11.3 負荷テストでのユーザーセッション統合
    - ワーカープールでのランダムユーザーセッション選択
    - セッション期限切れ時の自動再ログイン機能
    - ログイン失敗時のエラーハンドリングと継続処理
    - _Requirements: 8.4, 8.5, 8.6_

  - [x] 11.4 複数ユーザーログイン機能の動作確認
    - 複数ユーザーでのログインテスト
    - セッション管理とランダム選択の確認
    - New RelicでのユーザーID毎の分析データ確認
    - _Requirements: 8.2, 8.3, 8.4_

- [ ] 12. Web UI APIログイン問題の修正
  - [x] 12.1 APIエンドポイントログ記録問題の診断と修正
    - APIリクエストログが表示されない問題の特定
    - ミドルウェアとログ設定の確認・修正
    - APIルーティングの動作確認
    - _Requirements: 8.1, 8.2_

  - [x] 12.2 Web UIからのユーザーログイン機能の修正
    - Login All Usersボタンの動作問題を特定・修正
    - APIとダイレクトテストの結果差異の解決
    - UserSessionManagerインスタンス管理の統一
    - _Requirements: 8.2, 8.3_

  - [x] 12.3 ユーザーセッション管理の統合テスト
    - Web UIでのAdd User機能の動作確認
    - Login All Users機能の完全な動作テスト
    - セッション状態の正確な表示確認
    - _Requirements: 8.1, 8.2, 8.3, 8.4_